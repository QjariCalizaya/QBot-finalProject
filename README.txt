QBot – Telegram-бот для управления техническими заявками
========================================================

Описание
--------
QBot — это Telegram-бот, предназначенный для управления заявками
на техническое обслуживание.
Он позволяет пользователям:
- Оформлять заявку на техническое обслуживание
- Редактировать дату, время или адрес
- Отменять заявку
- Просматривать активную заявку
- Продолжать процесс в случае его прерывания

Система спроектирована с поддержкой сохранения состояния,
контроля конкурентного доступа, логирования событий
и автоматизированного тестирования.

--------------------------------------------------

Используемые технологии
-----------------------
- Python 3.11
- pyTelegramBotAPI (telebot)
- SQLite3
- pytest
- pytest-cov
- dotenv
- logging

--------------------------------------------------

Структура проекта
-----------------
.
├── main.py              # Основная логика бота
├── db.py                # Работа с базой данных и бизнес-логика
├── states.py            # Определение состояний пользователя (FSM)
├── config.py            # Общая конфигурация
├── logging_config.py    # Конфигурация логирования
├── database/            # База данных SQLite
├── tests/               # Автоматизированные тесты
│   ├── test_appointments.py
│   ├── test_constraints.py
│   └── test_user_state.py
├── README.txt
├── logs
└── .env


--------------------------------------------------

Основные функции
----------------

1. Создание заявки
   - Выбор проблемы
   - Ввод имени, телефона и адреса
   - Выбор доступной даты и времени
   - Подтверждение заявки

2. Редактирование заявки
   - Изменение даты и времени
   - Изменение адреса
   - Используется существующая активная заявка

3. Отмена заявки
   - Явное подтверждение
   - Логическая отмена (status = canceled)

4. Просмотр активной заявки
   - Команда /myappointment
   - Отображение всех данных заявки
   - Возможность редактирования или отмены через кнопки

5. Сохранение состояния
   - Бот запоминает прогресс пользователя
   - Процесс может быть продолжен после перезапуска

--------------------------------------------------

База данных
-----------
В проекте используется база данных SQLite, содержащая:

Таблица appointments:
- id
- user_id
- name
- phone
- address
- date
- hour
- type
- status (active | canceled)
- created_at

Важные ограничения:
- Только одна активная заявка на пользователя
- Только одна активная заявка на конкретную дату и время

Эти правила реализованы на уровне базы данных
с помощью уникальных индексов.

--------------------------------------------------

Контроль конкурентного доступа
------------------------------
- Исключена возможность бронирования одного времени
  несколькими пользователями
- Один пользователь не может иметь более одной активной заявки
- При редактировании заявки ранее выбранное время
  корректно освобождается

--------------------------------------------------

Логирование
-----------
Проект использует структурированное логирование
с различными уровнями:

- INFO:
  - Создание заявок
  - Обновление заявок
  - Отмена заявок
  - Подтверждения действий пользователя

- ERROR:
  - Ошибки базы данных
  - Необработанные исключения

Логи позволяют отслеживать поведение системы
и упрощают отладку.

--------------------------------------------------

Тестирование
------------
Используются автоматизированные тесты с помощью pytest.

Зависимости:
- pytest
- pytest-cov
- pytest-mock
- freezegun
- responses

Покрытие тестами:
- Создание заявок
- Обновление заявок
- Отмена заявок
- Проверка ограничений уникальности
- Сохранение состояния пользователя

Запуск тестов:
pytest --cov=db --cov-report=term-missing

--------------------------------------------------

Переменные окружения
--------------------
Требуемый файл .env:

TOKEN=ВАШ_TELEGRAM_TOKEN
DB_PATH=bot.sqlite3

--------------------------------------------------

Запуск проекта
--------------
1. Создать виртуальное окружение
2. Установить зависимости
3. Настроить файл .env
4. Запустить:

python main.py

--------------------------------------------------

Заключение
----------
QBot — это функциональный, надёжный и расширяемый проект.
Он реализует лучшие практики:
- модульного проектирования
- сохранения состояния
- обработки ошибок
- логирования
- автоматизированного тестирования

Система готова к дальнейшему расширению,
но уже полностью соответствует требованиям
учебного или практического проекта.
